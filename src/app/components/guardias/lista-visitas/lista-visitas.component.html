<div *ngIf="paginatedVisitas.length > 0; else noVisitas" class="w-full max-w-4xl overflow-x-auto">
  <table class="min-w-full border border-gray-400 border-collapse text-sm text-center shadow-sm">
    <thead class="bg-[#001b87] text-white">
      <tr>
        <th>Nombre</th>
        <th>RUT</th>
        <th>Vehículo</th>
        <th>Patente</th>
        <th>Tipo visita</th>
        <th>Autorizado por</th>
        <th>Destino</th>
        <th>Ingreso</th>
        <th>Salida</th>
        <th>Guardia</th>
        <th>Acción</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let v of paginatedVisitas; let i = index" [ngClass]="{ 'bg-gray-50': i % 2 === 0 }">
        <td>{{ v.nombre || 'Sin nombre' }}</td>
        <td>{{ v.rut || '—' }}</td>
        <td>{{ v.tipoVehiculo || '—' }}</td>
        <td>{{ v.patente || '—' }}</td>

        <td>
          <span
            class="px-2 py-1 rounded text-white text-xs font-semibold"
            [ngClass]="{
              'bg-blue-600': v.tipoVisita === 'visita',
              'bg-green-600': v.tipoVisita === 'delivery',
              'bg-yellow-600': v.tipoVisita === 'trabajador'
            }"
          >
            {{ v.tipoVisita }}
          </span>
        </td>

        <td>{{ v.autorizadoPor }}</td>
        <td>{{ v.lugarDestino }}</td>

        <td>{{ v.fechaHoraIngreso | date:'dd/MM/yyyy HH:mm' }}</td>

        <td>
          <span *ngIf="v.fechaHoraSalida; else pendiente">
            {{ v.fechaHoraSalida | date:'dd/MM/yyyy HH:mm' }}
          </span>
          <ng-template #pendiente>—</ng-template>
        </td>

        <td>{{ v.guardia?.nombre || v.guardia?.usuario?.nombre || '—' }}</td>

        <td>
          <ion-button
            color="success"
            size="small"
            (click)="registrarSalida(v)"
            [disabled]="v.fechaHoraSalida"
          >
            Marcar salida
          </ion-button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #noVisitas>
  <p class="text-center text-gray-500 mt-4">No hay registros de ingresos.</p>
</ng-template>

<div class="flex justify-center items-center gap-4 mt-6" *ngIf="totalPages > 1">
  <ion-button fill="outline" (click)="prevPage()" [disabled]="currentPage === 1">
    Anterior
  </ion-button>

  <span class="text-sm font-medium">Página {{ currentPage }} de {{ totalPages }}</span>

  <ion-button fill="outline" (click)="nextPage()" [disabled]="currentPage === totalPages">
    Siguiente
  </ion-button>
</div>

<div class="espaciador"></div>
